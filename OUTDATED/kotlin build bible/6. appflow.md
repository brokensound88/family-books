# App Flow Document for FamilyBooks

## **Overview**

**FamilyBooks** is an iOS-first mobile application designed to empower families to manage their finances, synchronize bank accounts, superannuation (with a focus on the Australian market), savings, and investment accounts, educate children on saving and investing, and balance household budgets through a visually stunning, gamified interface. Built using **Kotlin Multiplatform Mobile (KMM)** for shared business logic and **SwiftUI** for the iOS frontend, the app is developed with **Windsurf** (IntelliJ-based IDE) and **Cursor** (AI-driven IDE) for vibe-coding, leveraging AI-assisted tools like GitHub Copilot and Figma plugins (Magician, Builder.io) for rapid prototyping and code generation. This App Flow Document outlines the user flows, screen transitions, interaction patterns, and navigation structure for the iOS app, ensuring an intuitive, engaging, and accessible experience for families, including parents and children (ages 8–18). The document also considers future Android implementation with Jetpack Compose, ensuring consistency across platforms. The flows are designed to align with the app’s goals of financial management, kid education, and family collaboration, while leveraging SwiftUI’s native capabilities for a seamless iOS experience.

## **Objectives**

- Define clear, intuitive user flows for all core app functionalities: account syncing, budgeting, kid education, investment tracking, and family collaboration.
- Ensure a visually stunning and gamified SwiftUI interface with smooth transitions and animations.
- Support accessibility (VoiceOver, dynamic type) and localization (English, Australian English).
- Integrate with KMM backend logic for real-time data updates and API interactions.
- Leverage vibe-coding in Windsurf and Cursor to prototype and refine flows using AI tools.
- Design flows scalable for future Android implementation with Jetpack Compose.
- Achieve a 4.5+ App Store rating through engaging, family-friendly UX.

## **App Flow Scope**

### **MVP User Flows**

The iOS app, built with SwiftUI, includes the following core user flows for the Minimum Viable Product (MVP):

1. **Onboarding and Account Setup**:
   - User registration, family account creation, and financial account syncing.
2. **Dashboard**:
   - Overview of net worth, budgets, spending trends, and kids’ savings goals.
3. **Budgeting and Bookkeeping**:
   - Create/edit budgets, view transactions, and manage bill reminders.
4. **Kids’ Education Module**:
   - Interactive lessons, savings goals, and virtual stock portfolios for kids.
   - Parental oversight for goal approvals.
5. **Investment and Savings Tracking**:
   - Monitor portfolios and superannuation, set savings goals.
6. **Family Collaboration**:
   - Manage family accounts, shared goals, and notifications.
7. **Settings**:
   - Customize themes, manage accounts, and configure notifications.

### **Future Flows (Post-MVP)**

- Android implementation with Jetpack Compose, reusing KMM logic.
- Advanced investment tools (e.g., robo-advisory flows).
- Apple Watch flows for quick budget checks.
- Web app flows for desktop access.

## **Navigation Structure**

### **Overview**

The app uses a **tab-based navigation** structure with SwiftUI’s `TabView` for primary sections, combined with `NavigationStack` for hierarchical navigation within each section. This ensures intuitive access to core features while maintaining a clean, family-friendly UX.

- **Tabs**:
  - **Dashboard**: Overview of financial health.
  - **Budgets**: Budget creation and transaction management.
  - **Kids**: Educational modules and goal tracking.
  - **Investments**: Portfolio and superannuation tracking.
  - **Settings**: Account and app customization.
- **Example SwiftUI Navigation**:

  ```swift
  struct MainView: View {
      var body: some View {
          TabView {
              DashboardView()
                  .tabItem { Label("Dashboard", systemImage: "house.fill") }
              BudgetView()
                  .tabItem { Label("Budgets", systemImage: "dollarsign.circle") }
              KidsView()
                  .tabItem { Label("Kids", systemImage: "person.2.fill") }
              InvestmentsView()
                  .tabItem { Label("Investments", systemImage: "chart.line.uptrend.xyaxis") }
              SettingsView()
                  .tabItem { Label("Settings", systemImage: "gear") }
          }
          .accentColor(.blue)
      }
  }
  ```

### **Accessibility**

- Each tab and navigation element includes VoiceOver labels:

  ```swift
  .tabItem { Label("Dashboard", systemImage: "house.fill") }
      .accessibilityLabel("Home dashboard")
  ```

- Support dynamic type and high-contrast modes for readability.

## **Core User Flows**

### **1. Onboarding and Account Setup**

**Purpose**: Guide new users through registration, family account creation, and financial account syncing.

- **Flow**:
  1. **Welcome Screen**:
     - Displays app logo, tagline (“Grow Your Family’s Wealth”), and “Get Started” button.
     - SwiftUI Example:

       ```swift
       struct WelcomeView: View {
           var body: some View {
               VStack {
                   Image("appLogo")
                       .resizable()
                       .scaledToFit()
                       .frame(width: 200)
                   Text("Grow Your Family’s Wealth")
                       .font(.largeTitle)
                       .foregroundStyle(.blue.gradient)
                   Button("Get Started") {
                       // Navigate to SignUpView
                   }
                   .buttonStyle(.borderedProminent)
                   .padding()
               }
               .accessibilityLabel("Welcome to FamilyBooks")
           }
       }
       ```

  2. **Sign-Up/Login**:
     - Options for email/password or OAuth (Google, Apple) via Firebase.
     - KMM handles authentication:

       ```kotlin
       class AuthService {
           suspend fun signUp(email: String, password: String): User {
               return FirebaseAuth.createUser(email, password).toUser()
           }
       }
       ```

     - SwiftUI integration:

       ```swift
       struct SignUpView: View {
           @StateObject private var viewModel = AuthViewModel()
           @State private var email = ""
           @State private var password = ""
           var body: some View {
               Form {
                   TextField("Email", text: $email)
                   SecureField("Password", text: $password)
                   Button("Sign Up") {
                       Task { await viewModel.signUp(email: email, password: password) }
                   }
               }
               .navigationTitle("Sign Up")
           }
       }
       ```

  3. **Family Setup**:
     - Create a family account with roles (admin for parents, child for kids).
     - KMM logic:

       ```kotlin
       data class Family(val id: String, val name: String, val members: List<User>)
       suspend fun createFamily(name: String, adminEmail: String): Family {
           return FirestoreClient.createFamily(name, adminEmail)
       }
       ```

  4. **Account Syncing**:
     - Connect to banks/super funds via Plaid/Yodlee or FinanceKit (iOS).
     - Manual CSV import option.
     - SwiftUI flow:

       ```swift
       struct AccountSyncView: View {
           @StateObject private var viewModel = AccountViewModel()
           var body: some View {
               VStack {
                   Button("Connect Bank") {
                       Task { await viewModel.connectPlaid() }
                   }
                   Button("Import CSV") {
                       // Present file picker
                   }
               }
               .navigationTitle("Connect Accounts")
               .task { await viewModel.loadFinanceKitAccounts() }
           }
       }
       ```

- **User Experience**:
  - Animated transitions (e.g., fade-in for buttons) using SwiftUI’s `.animation`.
  - Clear error messages for failed syncs (e.g., “Invalid credentials”).
  - Guided prompts to simplify setup for non-technical users.

### **2. Dashboard**

**Purpose**: Provide a high-level overview of financial health, budgets, and kids’ goals.

- **Flow**:
  1. **Main Dashboard**:
     - Displays net worth, spending trends (via SwiftUI `Chart`), and financial health score.
     - Quick links to budgets and kids’ goals.
     - SwiftUI Example:

       ```swift
       struct DashboardView: View {
           @StateObject private var viewModel = DashboardViewModel()
           var body: some View {
               NavigationStack {
                   ScrollView {
                       VStack {
                           Chart {
                               ForEach(viewModel.spendingData) { data in
                                   BarMark(x: .value("Category", data.category), y: .value("Amount", data.amount))
                                       .foregroundStyle(.blue.gradient)
                               }
                           }
                           .frame(height: 200)
                           Text("Net Worth: $\(viewModel.netWorth, specifier: "%.2f")")
                               .font(.title)
                           NavigationLink("View Budgets", destination: BudgetView())
                           NavigationLink("Kids’ Goals", destination: KidsView())
                       }
                   }
                   .navigationTitle("Family Wealth")
                   .task { await viewModel.loadData() }
               }
           }
       }
       ```

  2. **KMM Integration**:
     - Fetches data from Plaid/Yodlee and Firestore:

       ```kotlin
       class DashboardRepository {
           suspend fun getNetWorth(familyId: String): Double {
               val accounts = FirestoreClient.getAccounts(familyId)
               return accounts.sumOf { it.balance }
           }
           suspend fun getSpendingData(familyId: String): List<CategoryData> {
               val transactions = FirestoreClient.getTransactions(familyId)
               return transactions.groupByCategory()
           }
       }
       ```

- **User Experience**:
  - Animated chart transitions (e.g., bars scale in on load).
  - Tap-to-zoom on charts for detailed insights.
  - Accessibility labels for charts:

    ```swift
    Chart { ... }
        .accessibilityLabel("Spending by category chart")
    ```

### **3. Budgeting and Bookkeeping**

**Purpose**: Enable users to create, manage, and track budgets and transactions.

- **Flow**:
  1. **Budget Overview**:
     - List of budgets with progress bars.
     - SwiftUI Example:

       ```swift
       struct BudgetView: View {
           @StateObject private var viewModel = BudgetViewModel()
           var body: some View {
               List(viewModel.budgets) { budget in
                   HStack {
                       Text(budget.name)
                       Spacer()
                       ProgressView(value: budget.spent / budget.amount)
                           .tint(.green)
                   }
               }
               .navigationTitle("Budgets")
               .toolbar {
                   Button("New Budget") { viewModel.showNewBudgetSheet = true }
               }
               .sheet(isPresented: $viewModel.showNewBudgetSheet) {
                   NewBudgetView(viewModel: viewModel)
               }
           }
       }
       ```

  2. **New Budget**:
     - Form to input name and amount, saved via KMM:

       ```kotlin
       suspend fun createBudget(familyId: String, name: String, amount: Double): Budget {
           val budget = Budget(id = UUID.randomUUID().toString(), familyId, name, amount, spent = 0.0)
           FirestoreClient.saveBudget(budget)
           return budget
       }
       ```

  3. **Transaction History**:
     - Display categorized transactions with swipe actions:

       ```swift
       struct TransactionListView: View {
           @StateObject private var viewModel = TransactionViewModel()
           var body: some View {
               List {
                   ForEach(viewModel.transactions) { transaction in
                       Text("\(transaction.description): $\(transaction.amount, specifier: "%.2f")")
                           .swipeActions {
                               Button("Edit Category") { viewModel.editCategory(transaction) }
                                   .tint(.blue)
                           }
                   }
               }
               .task { await viewModel.loadTransactions() }
           }
       }
       ```

- **User Experience**:
  - Animated progress bars for budget tracking.
  - AI-driven categorization with manual override.
  - Push notifications for bill reminders via Firebase.

### **4. Kids’ Education Module**

**Purpose**: Engage kids with gamified financial lessons and goal tracking.

- **Flow**:
  1. **Kids’ Dashboard**:
     - Displays savings goals and virtual portfolio with animations:

       ```swift
       struct KidsView: View {
           @StateObject private var viewModel = KidsViewModel()
           var body: some View {
               VStack {
                   Text("Your Savings Goals")
                       .font(.title2)
                   ForEach(viewModel.goals) { goal in
                       ProgressView(value: goal.current / goal.target)
                           .progressViewStyle(.circular)
                           .tint(.green)
                           .scaleEffect(1.5)
                           .animation(.spring(), value: goal.current)
                           .accessibilityLabel("Goal: \(goal.name), \(Int(goal.current / goal.target * 100))% complete")
                   }
                   NavigationLink("Learn Investing", destination: InvestingLessonView())
               }
           }
       }
       ```

  2. **Parental Oversight**:
     - Approve goals or transactions:

       ```swift
       struct ParentApprovalView: View {
           @StateObject private var viewModel = ParentViewModel()
           var body: some View {
               List(viewModel.pendingGoals) { goal in
                   HStack {
                       Text(goal.name)
                       Spacer()
                       Button("Approve") { Task { await viewModel.approveGoal(goal) } }
                   }
               }
               .navigationTitle("Approve Goals")
           }
       }
       ```

  3. **KMM Logic**:
     - Manage goals and approvals:

       ```kotlin
       suspend fun approveGoal(goalId: String): SavingsGoal {
           val goal = FirestoreClient.getGoal(goalId).copy(approved = true)
           FirestoreClient.updateGoal(goal)
           return goal
       }
       ```

- **User Experience**:
  - Gamified animations (e.g., confetti for goal completion).
  - Simplified UI for kids with large buttons and vibrant colors.

### **5. Investment and Savings Tracking**

**Purpose**: Monitor portfolios, superannuation, and savings goals.

- **Flow**:
  1. **Investment Overview**:
     - Display portfolio performance and superannuation data:

       ```swift
       struct InvestmentsView: View {
           @StateObject private var viewModel = InvestmentsViewModel()
           var body: some View {
               ScrollView {
                   Chart {
                       ForEach(viewModel.holdings) { holding in
                           LineMark(x: .value("Date", holding.date), y: .value("Value", holding.value))
                               .foregroundStyle(.purple.gradient)
                       }
                   }
                   .frame(height: 200)
                   Text("Portfolio Value: $\(viewModel.totalValue, specifier: "%.2f")")
               }
               .navigationTitle("Investments")
           }
       }
       ```

  2. **KMM Logic**:
     - Sync portfolio data:

       ```kotlin
       suspend fun fetchPortfolio(accountId: String): Portfolio {
           return PlaidApi.getPortfolio(accountId)
       }
       ```

- **User Experience**:
  - Interactive charts with pinch-to-zoom.
  - AI-driven savings suggestions (e.g., “Save $50 this month”).

### **6. Family Collaboration**

**Purpose**: Enable shared goals and role-based access.

- **Flow**:
  1. **Family Management**:
     - Add/remove family members with roles:

       ```swift
       struct FamilyView: View {
           @StateObject private var viewModel = FamilyViewModel()
           var body: some View {
               List(viewModel.members) { member in
                   Text("\(member.email) (\(member.role.rawValue))")
               }
               .toolbar { Button("Add Member") { viewModel.showAddMember = true } }
               .sheet(isPresented: $viewModel.showAddMember) { AddMemberView(viewModel: viewModel) }
           }
       }
       ```

  2. **Shared Goals**:
     - Track collaborative goals (e.g., vacation fund):

       ```swift
       struct SharedGoalView: View {
           @StateObject private var viewModel = SharedGoalViewModel()
           var body: some View {
               VStack {
                   Text(viewModel.goalName)
                   ProgressView(value: viewModel.progress)
                       .tint(.orange)
               }
           }
       }
       ```

- **User Experience**:
  - Real-time updates via Firestore.
  - Notifications for goal contributions.

### **7. Settings**

**Purpose**: Customize app preferences and manage accounts.

- **Flow**:
  1. **Profile and Accounts**:
     - Update email, password, or linked accounts.
  2. **Themes**:
     - Select vibrant themes (e.g., blue gradient, kid-friendly pastel).
  3. **Notifications**:
     - Configure bill reminders and goal alerts.

- **SwiftUI Example**:

  ```swift
  struct SettingsView: View {
      @StateObject private var viewModel = SettingsViewModel()
      var body: some View {
          Form {
              Section("Profile") {
                  TextField("Email", text: $viewModel.email)
              }
              Section("Theme") {
                  Picker("Theme", selection: $viewModel.theme) {
                      Text("Blue").tag("blue")
                      Text("Pastel").tag("pastel")
                  }
              }
          }
          .navigationTitle("Settings")
      }
  }
  ```

## **Vibe-Coding Workflow**

### **Tools**

- **Windsurf**: IntelliJ-based IDE for KMM logic, with Copilot for Kotlin.
- **Cursor**: AI-driven IDE for SwiftUI flows, with prompts like:

  ```swift
  // Create a SwiftUI navigation flow for budget creation with animated transitions
  ```

- **Figma + Magician/Builder.io**: AI-generated wireframes exported to SwiftUI.

### **Process**

1. **Wireframing** (2–3 weeks):
   - Use Figma with Magician for prompts like “iOS budget screen with animated progress bars.”
   - Export to SwiftUI via Builder.io.
2. **Prototyping** (1–2 weeks):
   - Build clickable Figma prototypes for each flow.
   - Validate with 10–20 families.
3. **Development** (6–8 weeks):
   - Code flows in Cursor with AI prompts:

     ```swift
     // Generate a SwiftUI flow for kids’ savings goals with gamified animations
     ```

   - Integrate KMM logic in Windsurf:

     ```kotlin
     // Create a Kotlin function to fetch family data from Firestore
     ```

4. **Testing** (2–3 weeks):
   - Use XCTest for navigation and interaction testing:

     ```swift
     func testBudgetNavigation() {
         let app = XCUIApplication()
         app.tabBars.buttons["Budgets"].tap()
         XCTAssertTrue(app.navigationBars["Budgets"].exists)
     }
     ```

## **Success Criteria**

- **Usability**: 90%+ of beta testers find flows intuitive.
- **Performance**: Screen transitions in <1 second, animations at 60 FPS.
- **Accessibility**: Full VoiceOver and dynamic type support.
- **Engagement**: Kids complete 80%+ of educational modules.

## **Conclusion**

This App Flow Document provides a detailed blueprint for the **FamilyBooks** user experience, ensuring intuitive, engaging, and accessible flows for families. By leveraging SwiftUI and KMM, with vibe-coding in Windsurf and Cursor, the app delivers a seamless iOS MVP with scalability for Android. The flows balance functionality, visual appeal, and kid-friendly gamification, setting the stage for a successful launch.

*Word Count: ~2100*

```

---
