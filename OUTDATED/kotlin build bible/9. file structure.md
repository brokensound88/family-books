# File Structure Document for FamilyBooks

## **Overview**

**FamilyBooks** is an iOS-first mobile application designed to empower families to manage their finances, synchronize bank accounts, superannuation (with a focus on the Australian market), savings, and investment accounts, educate children on saving and investing, and balance household budgets through a visually stunning, gamified interface. The app leverages **Kotlin Multiplatform Mobile (KMM)** for shared business logic and **SwiftUI** for the iOS frontend, with plans for future Android expansion using Jetpack Compose. Development is driven by **Windsurf** (IntelliJ-based IDE) and **Cursor** (AI-driven IDE) for vibe-coding, utilizing AI-assisted tools like GitHub Copilot and Figma plugins (Magician, Builder.io) to accelerate wireframing, code generation, and debugging. This File Structure Document outlines the directory and file organization for the KMM and SwiftUI project, ensuring modularity, maintainability, and scalability. The structure supports integration with financial APIs (Plaid, Yodlee, FinanceKit), real-time collaboration via Firebase, and AI-driven features (AWS SageMaker, Core ML), while adhering to PCI DSS, GDPR, and Australia’s Privacy Act. The file structure is designed for clarity in Windsurf and Cursor, facilitating vibe-coding workflows and future Android implementation.

## **Objectives**

- Define a modular, intuitive file structure for KMM (shared logic) and SwiftUI (iOS frontend).
- Ensure clear separation of concerns for data models, repositories, UI components, and tests.
- Support integration with financial APIs, Firebase, and AWS services.
- Facilitate vibe-coding in Windsurf and Cursor with AI-assisted development (e.g., Copilot prompts).
- Enable scalability for Android implementation with Jetpack Compose, reusing 40–50% of KMM code.
- Maintain compliance with security and privacy regulations through organized security modules.
- Streamline development, testing, and deployment for a 6–11 month iOS MVP timeline.

## **File Structure Overview**

The project is organized into two primary modules: **KMM (shared)** for cross-platform logic and **iOS (SwiftUI)** for the native iOS frontend. The structure is designed for modularity, with separate directories for data models, repositories, UI components, and tests, ensuring clarity for developers using Windsurf and Cursor. The KMM module is further divided into `common`, `ios`, and `android` (for future use) to support platform-specific implementations. The structure includes configuration files, resources, and documentation to support vibe-coding and AI-assisted workflows.

### **Root Directory**

The root directory contains project-level configuration files, documentation, and subdirectories for KMM and iOS modules.

```
FamilyWealthBuilder/
├── shared/                     # KMM module for shared logic
├── ios/                        # iOS app with SwiftUI
├── docs/                       # Build Bible documentation
├── .gitignore                  # Git ignore file
├── README.md                   # Project overview
├── build.gradle.kts            # Gradle config for KMM
├── Podfile                     # CocoaPods for iOS dependencies
├── fastlane/                   # Deployment automation
│   ├── Fastfile                # Fastlane configuration
│   └── Appfile                 # App Store Connect settings
```

- **`.gitignore`**: Excludes build artifacts, IDE files, and sensitive data (e.g., API keys).
- **README.md**: Overview of project setup, dependencies, and build instructions.
- **`build.gradle.kts`**: Configures KMM dependencies (e.g., Kotlin, Firebase, Plaid).
- **`Podfile`**: Manages iOS dependencies (e.g., Firebase SDK).
- **`fastlane/`**: Automates App Store deployment with Fastlane.

### **KMM Module (shared/)**

The `shared` directory contains the KMM module for cross-platform logic, organized into packages for data, domain, and platform-specific implementations.

```
shared/
├── src/
│   ├── commonMain/
│   │   ├── kotlin/
│   │   │   ├── data/
│   │   │   │   ├── model/
│   │   │   │   │   ├── User.kt
│   │   │   │   │   ├── Transaction.kt
│   │   │   │   │   ├── Budget.kt
│   │   │   │   │   ├── SavingsGoal.kt
│   │   │   │   │   └── Portfolio.kt
│   │   │   ├── repository/
│   │   │   │   ├── AuthRepository.kt
│   │   │   │   ├── TransactionRepository.kt
│   │   │   │   ├── BudgetRepository.kt
│   │   │   │   ├── SavingsGoalRepository.kt
│   │   │   │   └── PortfolioRepository.kt
│   │   │   ├── service/
│   │   │   │   ├── PlaidClient.kt
│   │   │   │   ├── YodleeClient.kt
│   │   │   │   ├── FirebaseClient.kt
│   │   │   │   ├── SageMakerClient.kt
│   │   │   │   └── NotificationService.kt
│   │   │   ├── util/
│   │   │   │   ├── EncryptionUtil.kt
│   │   │   │   ├── CacheManager.kt
│   │   │   │   └── Logger.kt
│   ├── iosMain/
│   │   ├── kotlin/
│   │   │   ├── repository/
│   │   │   │   ├── AuthRepositoryImpl.kt
│   │   │   │   ├── TransactionRepositoryImpl.kt
│   │   │   │   ├── BudgetRepositoryImpl.kt
│   │   │   │   ├── SavingsGoalRepositoryImpl.kt
│   │   │   │   └── PortfolioRepositoryImpl.kt
│   │   │   ├── platform/
│   │   │   │   └── KeychainService.kt
│   ├── androidMain/            # Placeholder for Android (post-MVP)
│   │   ├── kotlin/
│   │   │   ├── repository/
│   │   │   └── platform/
│   ├── commonTest/
│   │   ├── kotlin/
│   │   │   ├── repository/
│   │   │   │   ├── AuthRepositoryTest.kt
│   │   │   │   ├── TransactionRepositoryTest.kt
│   │   │   │   ├── BudgetRepositoryTest.kt
│   │   │   │   ├── SavingsGoalRepositoryTest.kt
│   │   │   │   └── PortfolioRepositoryTest.kt
├── build.gradle.kts            # KMM module build configuration
```

- **commonMain/**: Platform-agnostic Kotlin code.
  - **data/model/**: Data classes for core entities.

    ```kotlin
    // shared/src/commonMain/kotlin/data/model/Transaction.kt
    package data.model
    data class Transaction(
        val id: String,
        val accountId: String,
        val amount: Double,
        val date: String,
        val description: String,
        val category: String? = null
    )
    ```

  - **repository/**: Interfaces for data operations.

    ```kotlin
    // shared/src/commonMain/kotlin/repository/TransactionRepository.kt
    package repository
    expect interface TransactionRepository {
        suspend fun fetchTransactions(accountId: String): List<Transaction>
        suspend fun categorizeTransactions(transactions: List<Transaction>): List<Transaction>
    }
    ```

  - **service/**: API clients and services.

    ```kotlin
    // shared/src/commonMain/kotlin/service/PlaidClient.kt
    package service
    class PlaidClient {
        suspend fun authenticate(credentials: AccountCredentials): String {
            // Expect/actual implementation
        }
        suspend fun getTransactions(accountId: String): List<Transaction> {
            // Expect/actual implementation
        }
    }
    ```

  - **util/**: Helper classes for encryption, caching, and logging.

    ```kotlin
    // shared/src/commonMain/kotlin/util/CacheManager.kt
    package util
    expect class CacheManager {
        suspend fun cacheTransactions(transactions: List<Transaction>)
        suspend fun getCachedTransactions(): List<Transaction>
    }
    ```

- **iosMain/**: iOS-specific implementations.
  - **repository/**: Actual implementations for iOS.

    ```kotlin
    // shared/src/iosMain/kotlin/repository/TransactionRepositoryImpl.kt
    package repository
    actual class TransactionRepositoryImpl : TransactionRepository {
        private val plaidClient = PlaidClient()
        actual suspend fun fetchTransactions(accountId: String): List<Transaction> {
            return plaidClient.getTransactions(accountId)
        }
        actual suspend fun categorizeTransactions(transactions: List<Transaction>): List<Transaction> {
            return SageMakerClient.categorize(transactions)
        }
    }
    ```

  - **platform/**: iOS-specific utilities (e.g., Keychain integration).

    ```kotlin
    // shared/src/iosMain/kotlin/platform/KeychainService.kt
    package platform
    actual class KeychainService {
        actual fun saveToken(token: String) {
            // Call Swift Keychain API
        }
    }
    ```

- **androidMain/**: Placeholder for Android-specific implementations (post-MVP).
- **commonTest/**: Unit tests for shared logic.

  ```kotlin
  // shared/src/commonTest/kotlin/repository/TransactionRepositoryTest.kt
  package repository
  import kotlinx.coroutines.test.runTest
  @Test
  fun testTransactionFetch() = runTest {
      val repo = TransactionRepositoryImpl()
      val transactions = repo.fetchTransactions("account123")
      assertEquals(2, transactions.size)
  }
  ```

### **iOS Module (ios/)**

The `ios` directory contains the SwiftUI app, including UI components, view models, and tests.

```
ios/
├── FamilyWealthBuilder/
│   ├── Views/
│   │   ├── Dashboard/
│   │   │   ├── DashboardView.swift
│   │   │   └── DashboardViewModel.swift
│   │   ├── Budget/
│   │   │   ├── BudgetView.swift
│   │   │   ├── NewBudgetView.swift
│   │   │   └── BudgetViewModel.swift
│   │   ├── Kids/
│   │   │   ├── SavingsJarView.swift
│   │   │   ├── InvestingLessonView.swift
│   │   │   ├── ParentApprovalView.swift
│   │   │   └── KidsViewModel.swift
│   │   ├── Investments/
│   │   │   ├── InvestmentsView.swift
│   │   │   └── InvestmentsViewModel.swift
│   │   ├── Family/
│   │   │   ├── FamilyView.swift
│   │   │   ├── SharedGoalView.swift
│   │   │   └── FamilyViewModel.swift
│   │   ├── Settings/
│   │   │   ├── SettingsView.swift
│   │   │   └── SettingsViewModel.swift
│   │   ├── Onboarding/
│   │   │   ├── WelcomeView.swift
│   │   │   ├── SignUpView.swift
│   │   │   ├── AccountSyncView.swift
│   │   │   └── OnboardingViewModel.swift
│   │   └── Components/
│   │       ├── GoalCard.swift
│   │       ├── BudgetCard.swift
│   │       ├── TransactionRow.swift
│   │       └── ConfettiView.swift
│   ├── Models/
│   │   ├── CategoryData.swift
│   │   └── Holding.swift
│   ├── Services/
│   │   ├── FinanceKitService.swift
│   │   └── CoreMLService.swift
│   ├── Extensions/
│   │   └── KMMExtensions.swift
│   ├── Resources/
│   │   ├── Assets.xcassets/
│   │   │   ├── AppIcon.appiconset/
│   │   │   └── Images/
│   │   ├── Localizable.strings
│   │   └── Fonts/
│   ├── App/
│   │   ├── FamilyWealthBuilderApp.swift
│   │   └── AppDelegate.swift
├── Tests/
│   ├── DashboardViewModelTests.swift
│   ├── BudgetViewModelTests.swift
│   ├── KidsViewModelTests.swift
│   ├── InvestmentsViewModelTests.swift
│   └── FamilyViewModelTests.swift
├── FamilyWealthBuilder.xcodeproj/
└── Package.swift                # Swift Package Manager dependencies
```

- **Views/**: SwiftUI views and view models, organized by feature.
  - **DashboardView.swift**:

    ```swift
    // ios/FamilyWealthBuilder/Views/Dashboard/DashboardView.swift
    import SwiftUI
    import shared
    struct DashboardView: View {
        @StateObject private var viewModel = DashboardViewModel()
        var body: some View {
            NavigationStack {
                ScrollView {
                    VStack {
                        Chart {
                            ForEach(viewModel.spendingData) { data in
                                BarMark(x: .value("Category", data.category), y: .value("Amount", data.amount))
                                    .foregroundStyle(.blue.gradient)
                            }
                        }
                        .frame(height: 200)
                        .animation(.easeInOut, value: viewModel.spendingData)
                        .accessibilityLabel("Spending by category chart")
                        Text("Net Worth: $\(viewModel.netWorth, specifier: "%.2f")")
                            .font(.title)
                            .dynamicTypeSize(.large)
                        NavigationLink("Budgets", destination: BudgetView())
                    }
                    .padding()
                }
                .navigationTitle("Family Wealth")
                .task { await viewModel.loadData() }
            }
        }
    }
    ```

  - **DashboardViewModel.swift**:

    ```swift
    // ios/FamilyWealthBuilder/Views/Dashboard/DashboardViewModel.swift
    import shared
    class DashboardViewModel: ObservableObject {
        @Published var netWorth: Double = 0.0
        @Published var spendingData: [CategoryData] = []
        private let repository: TransactionRepository = TransactionRepositoryImpl()
        func loadData() async {
            let transactions = try! await repository.fetchTransactions(accountId: "user123").toList()
            netWorth = transactions.reduce(0.0) { $0 + $1.amount }
            spendingData = transactions.groupByCategory()
        }
    }
    ```

- **Models/**: SwiftUI-specific data models for UI binding.

  ```swift
  // ios/FamilyWealthBuilder/Models/CategoryData.swift
  struct CategoryData: Identifiable {
      let id = UUID()
      let category: String
      let amount: Double
  }
  ```

- **Services/**: iOS-specific services (e.g., FinanceKit, Core ML).

  ```swift
  // ios/FamilyWealthBuilder/Services/FinanceKitService.swift
  import FinanceKit
  class FinanceKitService {
      func loadAccounts() async throws -> [FinanceAccount] {
          return try await FinanceStore.shared.accounts()
      }
  }
  ```

- **Extensions/**: Helpers for KMM integration.

  ```swift
  // ios/FamilyWealthBuilder/Extensions/KMMExtensions.swift
  import shared
  extension Array where Element == Transaction {
      func groupByCategory() -> [CategoryData] {
          // Convert KMM transactions to SwiftUI CategoryData
      }
  }
  ```

- **Resources/**: Assets, localization, and fonts.
  - **Assets.xcassets/**: App icons and images (e.g., bank logos).
  - **Localizable.strings**: English and Australian English translations.
- **App/**: Main app entry point.

  ```swift
  // ios/FamilyWealthBuilder/App/FamilyWealthBuilderApp.swift
  import SwiftUI
  @main
  struct FamilyWealthBuilderApp: App {
      var body: some Scene {
          WindowGroup {
              MainView()
          }
      }
  }
  ```

- **Tests/**: XCTest cases for SwiftUI.

  ```swift
  // ios/Tests/DashboardViewModelTests.swift
  import XCTest
  class DashboardViewModelTests: XCTestCase {
      func testNetWorthCalculation() async {
          let viewModel = DashboardViewModel(repository: MockTransactionRepository())
          await viewModel.loadData()
          XCTAssertEqual(viewModel.netWorth, 150.0)
      }
  }
  ```

### **Documentation (docs/)**

The `docs` directory contains the Build Bible for reference.

```
docs/
├── planning.md
├── businessplan.md
├── projectrequirements.md
├── frontend.md
├── backend.md
├── appflow.md
├── techstack.md
├── systemprompts.md
├── filestructure.md
├── testing.md
└── deployment.md
```

## **Vibe-Coding Workflow**

### **Tools**

- **Windsurf**: IntelliJ-based IDE for KMM development, with Copilot for Kotlin.
- **Cursor**: AI-driven IDE for SwiftUI, with prompts like:

  ```swift
  // Create a SwiftUI view for a kid’s savings goal with animated progress bar
  ```

- **Xcode**: SwiftUI previews and iOS testing.
- **Figma + Magician/Builder.io**: Wireframing and SwiftUI export.

### **Process**

1. **Project Setup** (1–2 weeks):
   - Initialize KMM in Windsurf:

     ```kotlin
     // Create KMM module with data, repository, and service packages
     ```

   - Set up Xcode project for SwiftUI, linking KMM module.
2. **KMM Development** (6–8 weeks):
   - Use Windsurf prompts for repositories:

     ```kotlin
     // Generate a KMM TransactionRepository with Plaid integration
     ```

   - Organize files under `shared/src/commonMain`.
3. **SwiftUI Development** (6–8 weeks):
   - Use Cursor prompts for views:

     ```swift
     // Generate a SwiftUI dashboard with animated charts
     ```

   - Structure views under `ios/FamilyWealthBuilder/Views`.
4. **Testing** (2–3 weeks):
   - Write JUnit tests in `shared/src/commonTest`.
   - Write XCTest cases in `ios/Tests`:

     ```swift
     // Create XCTest for BudgetViewModel
     ```

5. **Validation**: Use Xcode previews and TestFlight for UI testing.

## **Scalability and Maintenance**

- **Modularity**: Separate `data`, `repository`, and `service` packages for maintainability.
- **Reusability**: KMM structure supports 40–50% code reuse for Android.
- **Documentation**: Embed comments in code for clarity:

  ```kotlin
  // shared/src/commonMain/kotlin/repository/BudgetRepository.kt
  // Interface for managing budgets in Firestore
  expect interface BudgetRepository {
      suspend fun createBudget(familyId: String, name: String, amount: Double): Budget
  }
  ```

- **Version Control**: Use Git branches for features (e.g., `feature/budget`, `feature/kids`).

## **Security Considerations**

- **Sensitive Files**: Store API keys in `ios/FamilyWealthBuilder/Info.plist` (excluded from Git).
- **Encryption**: Implement in `shared/src/commonMain/kotlin/util/EncryptionUtil.kt`.
- **Access Control**: Role-based logic in `shared/src/commonMain/kotlin/repository/AuthRepository.kt`.

## **Success Criteria**

- **Clarity**: File structure is intuitive for 2–3 developers.
- **Modularity**: Features are isolated in separate directories.
- **Reusability**: KMM logic supports Android with minimal changes.
- **Performance**: Build time <30 seconds in Windsurf/Xcode.

## **Conclusion**

This File Structure Document provides a clear, modular blueprint for organizing the **FamilyBooks** project, ensuring efficient vibe-coding in Windsurf and Cursor. The structure supports KMM for shared logic and SwiftUI for iOS, with scalability for Android. By organizing files for data, UI, and tests, the project remains maintainable and compliant, setting the stage for a successful iOS MVP.

*Word Count: ~1900*

```

---
