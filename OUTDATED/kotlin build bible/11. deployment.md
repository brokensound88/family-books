# Deployment Guide for FamilyBooks

## **Overview**

**FamilyBooks** is an iOS-first mobile application designed to empower families to manage their finances, synchronize bank accounts, superannuation (with a focus on the Australian market), savings, and investment accounts, educate children on saving and investing, and balance household budgets through a visually stunning, gamified interface. The app leverages **Kotlin Multiplatform Mobile (KMM)** for shared business logic and **SwiftUI** for the iOS frontend, with plans for future Android expansion using Jetpack Compose. Development is driven by **Windsurf** (IntelliJ-based IDE) and **Cursor** (AI-driven IDE) for vibe-coding, utilizing AI-assisted tools like GitHub Copilot and Figma plugins (Magician, Builder.io) to accelerate wireframing, code generation, and debugging. This Deployment Guide outlines the processes for deploying the iOS app to the App Store, setting up backend services (Firebase, AWS), and preparing for future Android deployment to Google Play. It covers build automation, beta testing, App Store submission, post-launch monitoring, and maintenance, ensuring compliance with PCI DSS, GDPR, and Australia’s Privacy Act, and supporting scalability for 10,000 concurrent users. The guide leverages Windsurf and Cursor for AI-assisted deployment tasks, targeting a seamless launch and a 4.5+ App Store rating.

## **Objectives**

- Successfully deploy the iOS MVP to the App Store within 6–11 months.
- Configure Firebase and AWS for scalable backend services (authentication, database, AI).
- Automate build and deployment processes using Fastlane and Xcode.
- Conduct beta testing via TestFlight with 50–100 families to validate usability and engagement.
- Ensure compliance with Apple’s App Store guidelines, financial regulations, and privacy laws.
- Prepare infrastructure for future Android deployment to Google Play, reusing KMM logic.
- Leverage AI tools in Windsurf and Cursor to streamline deployment tasks and monitoring.

## **Deployment Scope**

### **MVP Deployment**

The iOS MVP deployment focuses on the following components:

1. **Backend Setup**:
   - Configure Firebase for authentication, Firestore, and notifications.
   - Set up AWS for SageMaker (AI categorization) and EC2/S3 (hosting/storage).
   - Integrate Plaid/Yodlee for financial data syncing and Stripe for payments.
2. **Build and Automation**:
   - Use Xcode and Fastlane for building and submitting the iOS app.
   - Automate KMM builds in Windsurf.
3. **Beta Testing**:
   - Distribute beta builds via TestFlight for user feedback.
4. **App Store Submission**:
   - Prepare assets, metadata, and compliance documentation for App Store review.
5. **Post-Launch Monitoring**:
   - Use Firebase Analytics and Crashlytics for performance and crash tracking.
6. **Maintenance**:
   - Handle updates, bug fixes, and API maintenance.

### **Future Deployment (Post-MVP)**

- Android app deployment to Google Play using Jetpack Compose.
- Web app deployment for desktop access.
- Advanced feature updates (e.g., robo-advisory, crypto tracking).

## **Deployment Process**

### **1. Backend Setup**

**Purpose**: Configure cloud services to support app functionality, scalability, and security.

- **Firebase Setup**:
  - **Authentication**:
    - Enable email, Google, and Apple Sign-In in Firebase Console.
    - Configure MFA for enhanced security.
    - KMM integration:

      ```kotlin
      // shared/src/commonMain/kotlin/repository/AuthRepository.kt
      expect interface AuthRepository {
          suspend fun signIn(email: String, password: String): User
          suspend fun signUp(email: String, password: String): User
      }
      actual class AuthRepositoryImpl : AuthRepository {
          actual suspend fun signIn(email: String, password: String): User {
              return FirebaseAuth.signIn(email, password).toUser()
          }
          actual suspend fun signUp(email: String, password: String): User {
              return FirebaseAuth.createUser(email, password).toUser()
          }
      }
      ```

  - **Firestore**:
    - Create collections: `users`, `transactions`, `budgets`, `savings_goals`, `portfolios`.
    - Set security rules for family-based access:

      ```javascript
      // Firebase Security Rules
      rules_version = '2';
      service cloud.firestore {
          match /databases/{database}/documents {
              match /users/{userId} {
                  allow read, write: if request.auth.uid == userId;
              }
              match /budgets/{budgetId} {
                  allow read, write: if resource.data.familyId == get(/databases/$(database)/documents/users/$(request.auth.uid)).data.familyId;
              }
          }
      }
      ```

  - **Cloud Messaging**:
    - Enable push notifications for bill reminders and goal updates.
    - KMM integration:

      ```kotlin
      // shared/src/commonMain/kotlin/service/NotificationService.kt
      class NotificationService {
          suspend fun sendBillReminder(userId: String, bill: Bill) {
              FirebaseMessaging.send(userId, "Bill due: ${bill.name} on ${bill.dueDate}")
          }
      }
      ```

  - **Analytics and Crashlytics**:
    - Enable Firebase Analytics for DAU, retention, and feature usage.
    - Configure Crashlytics for crash reporting.

- **AWS Setup**:
  - **SageMaker**:
    - Deploy a transaction categorization model using AWS SageMaker.
    - KMM integration:

      ```kotlin
      // shared/src/commonMain/kotlin/service/SageMakerClient.kt
      class SageMakerClient {
          suspend fun categorizeTransactions(descriptions: List<String>): List<String> {
              return AwsSageMaker.invokeEndpoint(descriptions)
          }
      }
      ```

  - **EC2/S3**:
    - Host custom backend logic or assets (e.g., bank logos).
    - Use CloudFormation for infrastructure-as-code:

      ```yaml
      # aws-cloudformation-template.yaml
      Resources:
        EC2Instance:
          Type: AWS::EC2::Instance
          Properties:
            InstanceType: t3.micro
            ImageId: ami-12345678
        S3Bucket:
          Type: AWS::S3::Bucket
          Properties:
            BucketName: family-wealth-assets
      ```

- **API Integrations**:
  - **Plaid/Yodlee**:
    - Register for API keys at plaid.com or yodlee.com.
    - Configure in KMM:

      ```kotlin
      // shared/src/commonMain/kotlin/service/PlaidClient.kt
      class PlaidClient {
          suspend fun authenticate(credentials: AccountCredentials): String {
              return PlaidApi.authenticate(credentials).accessToken
          }
      }
      ```

  - **Stripe**:
    - Set up payment processing for subscriptions.
    - KMM integration:

      ```kotlin
      // shared/src/commonMain/kotlin/service/PaymentService.kt
      class PaymentService {
          suspend fun createSubscription(userId: String, plan: String): Subscription {
              return StripeApi.createSubscription(userId, plan)
          }
      }
      ```

- **Security Configuration**:
  - Enable HTTPS/TLS 1.3 for all API calls.
  - Store API keys securely in `Info.plist` (iOS) and `local.properties` (KMM), excluded from Git.
  - Use iOS Keychain for credential storage:

    ```swift
    // ios/FamilyWealthBuilder/Services/KeychainService.swift
    import Security
    class KeychainService {
        func saveToken(token: String) {
            let data = token.data(using: .utf8)!
            let query: [String: Any] = [
                kSecClass as String: kSecClassGenericPassword,
                kSecAttrAccount as String: "userToken",
                kSecValueData as String: data
            ]
            SecItemAdd(query as CFDictionary, nil)
        }
    }
    ```

### **2. Build and Automation**

**Purpose**: Automate building and packaging of KMM and SwiftUI components for deployment.

- **KMM Build**:
  - Configure Gradle in Windsurf for KMM module:

    ```kotlin
    // shared/build.gradle.kts
    plugins {
        kotlin("multiplatform")
        id("com.android.library")
    }
    kotlin {
        ios()
        android()
        sourceSets {
            val commonMain by getting {
                dependencies {
                    implementation("org.jetbrains.kotlinx:kotlinx-coroutines-core:1.7.3")
                    implementation("com.google.firebase:firebase-firestore:24.7.0")
                }
            }
        }
    }
    ```

  - AI Prompt (Windsurf): “Generate a Gradle configuration for KMM with Firebase and Plaid dependencies.”
- **SwiftUI Build**:
  - Configure Xcode project with KMM framework.
  - Use CocoaPods for iOS dependencies:

    ```ruby
    // ios/Podfile
    platform :ios, '16.0'
    target 'FamilyWealthBuilder' do
        use_frameworks!
        pod 'Firebase/Auth'
        pod 'Firebase/Firestore'
        pod 'Firebase/Messaging'
    end
    ```

- **Fastlane Setup**:
  - Automate iOS build and submission:

    ```ruby
    // fastlane/Fastfile
    lane :beta do
        build_app(scheme: "FamilyWealthBuilder")
        upload_to_testflight
    end
    lane :release do
        build_app(scheme: "FamilyWealthBuilder")
        upload_to_app_store
    end
    ```

  - AI Prompt (Cursor): “Generate a Fastlane script for iOS TestFlight and App Store deployment.”

### **3. Beta Testing**

**Purpose**: Validate usability, performance, and engagement with real users.

- **Process**:
  - **TestFlight Setup**:
    - Create an App Store Connect account.
    - Upload beta build using Fastlane:

      ```ruby
      lane :beta do
          build_app(scheme: "FamilyWealthBuilder")
          upload_to_testflight(
              skip_waiting_for_build_processing: true,
              groups: ["FamilyTesters"]
          )
      end
      ```

  - **User Recruitment**:
    - Invite 50–100 families (parents and kids ages 8–18) via email, X campaigns, or parenting forums.
    - Focus on Australian users for superannuation testing.
  - **Feedback Collection**:
    - Use Firebase Analytics for usage metrics (DAU, retention, feature usage).
    - Example SwiftUI analytics view:

      ```swift
      // ios/FamilyWealthBuilder/Views/Analytics/AnalyticsView.swift
      struct AnalyticsView: View {
          @StateObject private var viewModel = AnalyticsViewModel()
          var body: some View {
              VStack {
                  Text("Beta Feedback")
                      .font(.title)
                  Text("Daily Active Users: \(viewModel.dau)")
                  Text("Retention Rate: \(viewModel.retention, specifier: "%.2f")%")
              }
              .task { await viewModel.loadAnalytics() }
          }
      }
      class AnalyticsViewModel: ObservableObject {
          @Published var dau: Int = 0
          @Published var retention: Double = 0.0
          func loadAnalytics() async {
              // Fetch from Firebase Analytics
          }
      }
      ```

  - **Test Scenarios**:
    - Onboarding: Complete setup in <5 minutes.
    - Budgeting: Create and track budgets.
    - Kids’ Module: 80%+ completion rate for educational tasks.
    - Accessibility: VoiceOver and dynamic type functionality.

- **AI Prompt (Cursor)**: “Generate a SwiftUI view to display beta testing analytics from Firebase.”

### **4. App Store Submission**

**Purpose**: Publish the iOS app to the App Store, ensuring compliance with Apple’s guidelines.

- **Process**:
  - **App Store Connect Setup**:
    - Create app listing with name, description, and keywords (e.g., “family finance,” “kids investing”).
    - Upload SwiftUI-generated screenshots and videos showcasing vibrant UI:

      ```swift
      // ios/FamilyWealthBuilder/Views/Dashboard/DashboardView.swift
      Chart { ... }
          .frame(height: 200)
          .foregroundStyle(.blue.gradient)
          .accessibilityLabel("Spending by category chart")
      ```

  - **Metadata**:
    - App Name: FamilyBooks
    - Description: “Empower your family to manage finances, track superannuation, and teach kids to save and invest with a stunning, gamified interface.”
    - Keywords: family finance, budgeting, superannuation, kids investing, financial literacy
    - Privacy Policy: Detail GDPR and Privacy Act compliance.
  - **Compliance**:
    - Ensure FinanceKit entitlement for Apple Wallet (iOS 18.4+).
    - Document Plaid/Yodlee and Stripe compliance with PCI DSS.
    - AI Prompt (Cursor): “Generate an App Store privacy policy template for a finance app.”
  - **Submission**:
    - Use Fastlane to upload build:

      ```ruby
      lane :release do
          build_app(scheme: "FamilyWealthBuilder")
          upload_to_app_store(
              submit_for_review: true,
              force: true
          )
      end
      ```

- **Review Preparation**:
  - Address Apple’s guidelines (e.g., no hidden features, clear financial data consent).
  - Test on multiple devices (iPhone 14, iPad Air) via Firebase Test Lab.

### **5. Post-Launch Monitoring**

**Purpose**: Track app performance, crashes, and user engagement post-launch.

- **Tools**:
  - **Firebase Analytics**: Monitor DAU, retention, and feature usage.
  - **Crashlytics**: Track crashes and errors.
  - **App Store Connect**: Review user ratings and feedback.
- **Process**:
  - Set up dashboards in Firebase Console for real-time metrics.
  - Monitor Crashlytics for issues:

    ```swift
    // ios/FamilyWealthBuilder/App/FamilyWealthBuilderApp.swift
    import Firebase
    @main
    struct FamilyWealthBuilderApp: App {
        init() {
            FirebaseApp.configure()
            Crashlytics.crashlytics().setCrashlyticsCollectionEnabled(true)
        }
        var body: some Scene {
            WindowGroup { MainView() }
        }
    }
    ```

  - Analyze user feedback for updates (e.g., new kid modules).
- **AI Prompt (Cursor)**: “Generate a SwiftUI view to display Crashlytics crash reports.”

### **6. Maintenance**

**Purpose**: Ensure ongoing app reliability and feature updates.

- **Process**:
  - **Bug Fixes**:
    - Use Crashlytics to identify and prioritize issues.
    - AI Prompt (Cursor): “Debug a SwiftUI view with a navigation crash.”
  - **Updates**:
    - Release bi-monthly updates via Fastlane.
    - Add features (e.g., advanced investment tracking).
  - **API Maintenance**:
    - Monitor Plaid/Yodlee for API changes.
    - Update SageMaker models for improved categorization.
  - **Compliance**:
    - Regularly audit for GDPR and Privacy Act compliance.
    - Update privacy policy as needed.

### **7. Future Android Deployment**

**Purpose**: Prepare for Android launch using Jetpack Compose, reusing KMM logic.

- **Process**:
  - Configure Android module in `shared/androidMain`.
  - Build Jetpack Compose UI in Android Studio:

    ```kotlin
    // shared/src/androidMain/kotlin/ui/DashboardScreen.kt
    @Composable
    fun DashboardScreen(viewModel: DashboardViewModel = viewModel()) {
        Column {
            Chart {
                viewModel.spendingData.forEach { data ->
                    Bar(data.category, data.amount, color = Color.Blue)
                }
            }
            Text("Net Worth: $${viewModel.netWorth}", style = MaterialTheme.typography.headlineMedium)
        }
    }
    ```

  - Use Fastlane for Google Play submission:

    ```ruby
    // fastlane/Fastfile
    lane :android_release do
        gradle(task: "assembleRelease")
        supply(
            package_name: "com.familywealthbuilder",
            apk: "app/build/outputs/apk/release/app-release.apk"
        )
    end
    ```

  - Test on Android devices via Firebase Test Lab.

## **Vibe-Coding Workflow**

### **Tools**

- **Windsurf**: IntelliJ-based IDE for KMM builds and API setup.
- **Cursor**: AI-driven IDE for SwiftUI and deployment scripts.
- **Xcode**: iOS build, testing, and App Store submission.
- **Fastlane**: Build and deployment automation.
- **Firebase/AWS Consoles**: Backend configuration and monitoring.

### **Process**

1. **Backend Setup** (1–2 weeks):
   - Configure Firebase and AWS using console and KMM code.
   - AI Prompt (Windsurf): “Generate KMM code for Firebase authentication.”
2. **Build Automation** (1 week):
   - Set up Fastlane in Cursor:

     ```ruby
     // Generate Fastlane configuration for iOS deployment
     ```

3. **Beta Testing** (1–2 weeks):
   - Distribute via TestFlight, analyze feedback with Firebase Analytics.
4. **App Store Submission** (1–2 weeks):
   - Use Fastlane for automated submission.
   - AI Prompt (Cursor): “Generate App Store metadata for a family finance app.”
5. **Monitoring and Maintenance** (Ongoing):
   - Use Firebase Analytics/Crashlytics for real-time insights.
   - AI Prompt (Cursor): “Generate a SwiftUI view for crash report analysis.”

## **Success Criteria**

- **Deployment Success**: App live on App Store with <7-day review time.
- **Beta Feedback**: 90%+ of testers rate UX as “intuitive.”
- **Performance**: App loads in <2 seconds, API responses <500ms.
- **Crash Rate**: <1% in production.
- **Compliance**: Meets PCI DSS, GDPR, and Privacy Act requirements.
- **Scalability**: Supports 10,000 concurrent users.

## **Conclusion**

This Deployment Guide ensures a smooth launch of **FamilyBooks** on the App Store, with robust backend setup, automated builds, and comprehensive beta testing. By leveraging Windsurf, Cursor, and AI tools, the deployment process is streamlined, supporting a high-quality iOS MVP and future Android expansion. The guide ensures compliance, performance, and user satisfaction, targeting a 4.5+ App Store rating.

*Word Count: ~2000*

---
