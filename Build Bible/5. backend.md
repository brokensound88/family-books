# Backend Structure Document for FamilyBooks

## **Overview**

**FamilyBooks** is an iOS 18-first mobile application designed to empower Australian families to manage their finances, synchronize bank accounts, superannuation, savings, and investment accounts, educate children on saving and investing, and balance household budgets through a visually stunning, gamified interface. Built entirely in **Swift** and **SwiftUI**, the app leverages the latest iOS 18 capabilities to deliver a native, high-performance experience on iPhone and iPad, with potential future expansion to macOS via Mac Catalyst. Development will utilize **Windsurf** (configured as a Swift-focused IDE) and **Cursor** (an AI-driven IDE) for vibe-coding, harnessing AI tools like GitHub Copilot and Figma plugins (Magician, Builder.io) to accelerate wireframing, code generation, and prototyping. This Backend Structure Document outlines the architecture, data models, services, security measures, and vibe-coding workflows for the app’s backend, supporting the Minimum Viable Product (MVP) scheduled for launch by July 2026 (adjusted from the original plan due to the current date of August 28, 2025). The backend integrates iOS 18 frameworks (e.g., SwiftData, CoreML), cloud services (Firebase, CloudKit, AWS SageMaker), and financial APIs (Plaid, Yodlee), ensuring compliance with PCI DSS, GDPR, and Australia’s Privacy Act while providing a scalable foundation for family-focused financial management.

## **Objectives**

- Design a robust backend to support MVP features: financial account syncing, budgeting, kids’ education, investment tracking, and family collaboration.
- Leverage SwiftData, CloudKit, and Firebase for local and cloud-based data persistence and real-time sync.
- Integrate iOS 18 frameworks (e.g., CoreML for AI, FinanceKit for account syncing) and external APIs (Plaid, Yodlee) for financial data.
- Ensure security compliance with PCI DSS, GDPR, and Australia’s Privacy Act through encryption and authentication.
- Utilize Windsurf and Cursor for AI-assisted vibe-coding to streamline backend development and testing.
- Support scalability for 10,000 concurrent users and future macOS expansion.
- Achieve a 4.5+ App Store rating through reliable backend performance.

## **Backend Architecture**

### **Overview**

The backend architecture is a hybrid model combining local persistence (SwiftData), cloud synchronization (CloudKit/Firestore), and external API integrations (Plaid, Yodlee). It is designed for iOS 18’s native capabilities, with a modular structure to support SwiftUI frontend components and potential macOS expansion via Mac Catalyst. The architecture emphasizes security, scalability, and real-time data updates.

### **Components**

1. **Data Layer**:
   - **SwiftData**: Local persistence for offline access (e.g., budgets, transactions).
   - **CloudKit/Firestore**: Real-time sync for family data and notifications.
2. **Service Layer**:
   - API clients for Plaid, Yodlee, and FinanceKit.
   - AI processing with CoreML and AWS SageMaker.
3. **Security Layer**:
   - Encryption with CryptoKit, authentication with LocalAuthentication and Apple Sign-In.
4. **Integration Layer**:
   - Bridges frontend SwiftUI views with backend services.

### **Architecture Diagram**

```
[SwiftUI Frontend]
       ↓
[Service Layer] ←→ [Data Layer]
   (API Clients,    (SwiftData, 
    CoreML)         CloudKit)
       ↓
[Security Layer]
   (CryptoKit, 
    LocalAuthentication)
       ↓
[External APIs]
   (Plaid, Yodlee, 
    FinanceKit, Stripe)
```

## **Data Models**

### **Core Entities**

- **User**:
  - Properties: `id`, `email`, `name`, `familyId`, `role` (admin/child).
  - Persistence: SwiftData and CloudKit.
  - Example:

    ```swift
    // ios/FamilyWealthBuilder/Models/User.swift
    import SwiftData
    @Model
    class User {
        var id: UUID
        var email: String
        var name: String
        var familyId: UUID?
        var role: String
        init(id: UUID = UUID(), email: String, name: String, familyId: UUID? = nil, role: String = "child") {
            self.id = id
            self.email = email
            self.name = name
            self.familyId = familyId
            self.role = role
        }
    }
    ```

- **Transaction**:
  - Properties: `id`, `accountId`, `amount`, `date`, `description`, `category`.
  - Persistence: SwiftData with CloudKit sync.
- **Budget**:
  - Properties: `id`, `name`, `amount`, `spent`, `familyId`.
  - Persistence: SwiftData.
- **SavingsGoal**:
  - Properties: `id`, `userId`, `name`, `target`, `current`, `approved`.
  - Persistence: SwiftData with parental approval via CloudKit.
- **Portfolio**:
  - Properties: `id`, `accountId`, `holdings`, `totalValue`.
  - Persistence: SwiftData with real-time updates.

### **Data Flow**

- Local data stored in SwiftData for offline access.
- Sync with CloudKit/Firestore for multi-device consistency.
- Example Sync Logic:

  ```swift
  // ios/FamilyWealthBuilder/Services/CloudSyncService.swift
  import CloudKit
  class CloudSyncService {
      func syncTransactions(transactions: [Transaction]) async throws {
          let container = CKContainer.default()
          let database = container.privateCloudDatabase
          let records = transactions.map { transaction in
              CKRecord(recordType: "Transaction", recordID: CKRecord.ID(recordName: transaction.id.uuidString))
          }
          try await database.save(records[0])
      }
  }
  ```

## **Services**

### **API Services**

- **FinanceKit Service**:
  - Syncs Apple Wallet accounts (iOS 18.4+).
  - Example:

    ```swift
    // ios/FamilyWealthBuilder/Services/FinanceKitService.swift
    import FinanceKit
    class FinanceKitService {
        func fetchAccounts() async throws -> [FinanceAccount] {
            return try await FinanceStore.shared.accounts()
        }
    }
    ```

- **Plaid/Yodlee Service**:
  - Handles external account syncing.
  - Example:

    ```swift
    // ios/FamilyWealthBuilder/Services/FinancialService.swift
    class FinancialService {
        private let plaidClient = PlaidClient()
        func fetchTransactions(accountId: String) async throws -> [Transaction] {
            let response = try await plaidClient.getTransactions(accountId: accountId)
            return response.map { Transaction(id: $0.id, accountId: accountId, amount: $0.amount, date: $0.date, description: $0.description) }
        }
    }
    ```

- **Stripe Service**:
  - Manages in-app purchases and subscriptions.
  - Example:

    ```swift
    // ios/FamilyWealthBuilder/Services/PaymentService.swift
    import StoreKit
    class PaymentService {
        func purchaseSubscription(productId: String) async throws -> Product.PurchaseResult {
            let products = try await StoreKit.Product.products(for: [productId])
            return try await products[0].purchase()
        }
    }
    ```

### **AI Service**

- **CoreML Service**:
  - On-device transaction categorization.
  - Example:

    ```swift
    // ios/FamilyWealthBuilder/Services/CoreMLService.swift
    import CoreML
    class CoreMLService {
        func categorizeTransaction(description: String) async -> String? {
            guard let model = try? TransactionClassifier(configuration: .init()) else { return nil }
            let prediction = try? model.prediction(text: description)
            return prediction?.category
        }
    }
    ```

### **Notification Service**

- **UserNotifications/WidgetKit**:
  - Sends reminders and updates widgets.
  - Example:

    ```swift
    // ios/FamilyWealthBuilder/Services/NotificationService.swift
    import UserNotifications
    class NotificationService {
        func scheduleBillReminder(bill: Bill) async {
            let content = UNMutableNotificationContent()
            content.title = "Bill Due"
            content.body = "\(bill.name) due on \(bill.dueDate)"
            let trigger = UNTimeIntervalNotificationTrigger(timeInterval: 86400, repeats: false)
            let request = UNNotificationRequest(identifier: bill.id, content: content, trigger: trigger)
            try? await UNUserNotificationCenter.current().add(request)
        }
    }
    ```

## **Security Measures**

### **Encryption**

- Use CryptoKit for data encryption.
- Example:

  ```swift
  // ios/FamilyWealthBuilder/Services/EncryptionService.swift
  import CryptoKit
  class EncryptionService {
      func encrypt(data: Data) throws -> Data {
          let key = SymmetricKey(size: .bits256)
          let sealedBox = try ChaChaPoly.seal(data, using: key)
          return sealedBox.combined
      }
  }
  ```

### **Authentication**

- Integrate LocalAuthentication for FaceID and Apple Sign-In.
- Example:

  ```swift
  // ios/FamilyWealthBuilder/Services/AuthService.swift
  import AuthenticationServices
  class AuthService {
      func signInWithApple() async throws -> ASAuthorizationAppleIDCredential {
          let request = ASAuthorizationAppleIDProvider().createRequest()
          let authorization = try await ASAuthorizationController.preauthorizationController(for: request).authorization
          return authorization.credential as! ASAuthorizationAppleIDCredential
      }
  }
  ```

### **Compliance**

- PCI DSS: Secure payment processing with Stripe.
- GDPR/Privacy Act: User consent management and data deletion via CloudKit.

## **Scalability**

- **CloudKit/Firestore**: Auto-scales to 10,000 users.
- **Caching**: SwiftData for offline access, reducing cloud load.
- **Load Testing**: Simulate 1,000 concurrent users with Xcode Instruments.

## **Vibe-Coding Workflow**

### **Tools**

- **Windsurf**: Swift IDE with Copilot for backend logic.
- **Cursor**: AI-driven IDE for Swift services and testing, with prompts like:

  ```swift
  // Generate Swift code for a FinanceKit account sync service
  ```

- **Xcode 16**: Backend testing and profiling.

### **Process**

1. **Planning (Now–September 2025)**:
   - Use Windsurf to draft backend structure, refine with Cursor prompts.
   - Example: “Generate Swift code for a SwiftData budget model.”
2. **Development (December 2025–April 2026)**:
   - Code sprints in Windsurf/Cursor, using AI prompts:

     ```swift
     // Create a Swift service for Plaid transaction syncing
     ```

   - Example Output:

     ```swift
     // ios/FamilyWealthBuilder/Services/FinancialService.swift
     class FinancialService {
         private let plaidClient = PlaidClient(apiKey: "your-api-key")
         func fetchTransactions(accountId: String) async throws -> [Transaction] {
             let response = try await plaidClient.getTransactions(accountId: accountId)
             return response.map { Transaction(id: $0.id, accountId: accountId, amount: $0.amount, date: $0.date, description: $0.description) }
         }
     }
     struct Transaction: Identifiable {
         let id: String
         let accountId: String
         let amount: Double
         let date: Date
         let description: String
     }
     ```

   - Integrate with SwiftData:

     ```swift
     // ios/FamilyWealthBuilder/Models/Budget.swift
     import SwiftData
     @Model
     class Budget {
         var id: UUID
         var name: String
         var amount: Double
         var spent: Double
         init(id: UUID = UUID(), name: String, amount: Double, spent: Double = 0.0) {
             self.id = id
             self.name = name
             self.amount = amount
             self.spent = spent
         }
     }
     ```

3. **Testing (May–June 2026)**:
   - Use Cursor for XCTest cases, Windsurf for SwiftData validation.
   - Example: “Generate XCTest for FinancialService transaction fetch.”
4. **Deployment (July 2026)**:
   - Configure Firebase/CloudKit, monitor with Analytics.

### **AI-Assisted Vibe-Coding**

- **Windsurf**: Use Copilot for Swift service generation:

  ```swift
  // Generate Swift code for a CloudKit sync service
  ```

- **Cursor**: Accelerate backend coding:

  ```swift
  // Create a Swift service for CoreML transaction categorization
  ```

- **Iterative Sprints**: Develop one service (e.g., FinancialService) per 2-week sprint.

## **Constraints**

- **iOS Version**: iOS 18+ limits compatibility to ~60% of users by mid-2026.
- **API Costs**: Plaid/Yodlee ($500–$5,000/month), Firebase ($500–$2,000/month).
- **FinanceKit**: Requires iOS 18.4+, with Plaid/Yodlee as fallback.
- **Development Time**: 6–9 months from September 2025 to July 2026.

## **Success Criteria**

- **Functionality**: All MVP services operational by April 2026.
- **Performance**: API responses <500ms, syncs <5 seconds.
- **Security**: No critical vulnerabilities in testing.
- **Scalability**: Handles 10,000 users with <1% error rate.
- **Compliance**: Meets PCI DSS, GDPR, and Privacy Act standards.

## **Conclusion**

This Backend Structure Document provides a comprehensive blueprint for **FamilyBooks**'s backend, leveraging Swift, SwiftData, and iOS 18 frameworks for a secure, scalable solution. By utilizing Windsurf and Cursor for vibe-coding, the structure supports efficient development, targeting a July 2026 launch with readiness for macOS expansion. The integration of modern services and AI-assisted workflows ensures a robust foundation for the app's financial and educational features.

*Word Count: ~2000*

```

---
